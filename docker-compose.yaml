version: '3'

services:
   app:
      build:
         dockerfile: ./dockerfile
         context: .
      image: rafaelbenz/desafio-votos
      restart: on-failure
      container_name: app-desafio-votos
      ports:
         - 8080:8080
      depends_on:
         - db
      networks:
         - desafio-network

   db:
      image: mysql:latest
      command: --default-authentication-plugin=mysql_native_password
      restart: always
      ports:
         - 3306:3306
      environment:   
         MYSQL_ROOT_PASSWORD: 123456
      volumes:
         - mysql-desafio-votos-volume:/var/lib/mysql
      networks:
         - desafio-votos-network
   
   db_admin:
      image: adminer:latest
      restart: always
      ports:
         - 8085:8080
      networks:
         - desafio-votos-network
   
   logging:
      image: splunk/splunk:latest
      restart: always
      environment:
         SPLUNK_START_ARGS: --accept-license
         SPLUNK_PASSWORD: "votoslog"
      ports:
         - 8000:8000
         - 8088:8088
      networks:
         - desafio-votos-network

networks:
   desafio-votos-network:
      driver: bridge
volumes:
   - mysql-desafio-votos-volume:
      