version: '3'

services:
   app-desafio-votos:
      build:
         dockerfile: ./dockerfile
         context: .
      image: rafaelbenz/desafio-votos
      restart: on-failure
      ports:
         - 8080:8080
      environment:
         BANCO_URL: jdbc:mysql://mysql-desafio-votos:3306/desafio_votos_db?allowPublicKeyRetrieval=true&sslMode=DISABLED
      depends_on:
         - mysql-desafio-votos
      networks:
         - desafio-votos-network

   mysql-desafio-votos:
      image: mysql:latest
      command: --default-authentication-plugin=mysql_native_password
      restart: always
      container_name: mysql-votos
      ports:
         - 3306:3306
      environment:
          MYSQL_ROOT_PASSWORD: 123456
          MYSQL_DATABASE: desafio_votos_db
      volumes:
         - mysql-desafio-votos-volume:/var/lib/mysql
      networks:
         - desafio-votos-network

   db_admin:
      image: adminer:latest
      restart: always
      ports:
         - 8085:8080
      networks:
         - desafio-votos-network

   splunk:
      image: splunk/splunk:latest
      restart: always
      environment:
         SPLUNK_START_ARGS: --accept-license
         SPLUNK_PASSWORD: "splunk123"
      ports:
         - 8000:8000
         - 8088:8088
      networks:
         - desafio-votos-network

networks:
   desafio-votos-network:
      driver: bridge
volumes:
   mysql-desafio-votos-volume:
      